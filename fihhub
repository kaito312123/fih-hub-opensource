-- [[ LIBRARY LOADING ]] --
local HttpRequest = request or http_request or http and http.request or syn and syn.request
local ModuleData = HttpRequest({Method = "GET", Url = "https://raw.githubusercontent.com/KadeTheExploiter/Machina/refs/heads/main/Module.luau"})
local GuiLibrary = loadstring(ModuleData.Body)()

-- [[ CONFIGURATIONS ]] --
local NOME_DA_PART = "WINPART"
local ALTURA_OFFSET = 7
local INTERVALO = 0.7 
local tpLigado = false
local afkLigado = false
local flyLigado = false
local blackScreenLigado = false
local flySpeed = 50
local winsCount = 0

-- [[ SERVICES ]] --
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- [[ SIGMA HUB INTERFACE ]] --
local MainFrame, ScreenGui = GuiLibrary:Load("Sigma Hub", "Dark")

local Tabs = {
    Main = MainFrame:NewTabEntry("Main", "rbxassetid://10734945662"),
    Utilities = MainFrame:NewTabEntry("Utilities", "rbxassetid://10734944532")
}

-- [[ WINS COUNTER ]] --
local WinsLabel = Tabs.Main:NewLabelEntry(
    "Wins: 0", 
    "Wins get on farm", 
    "Positive"
)

task.spawn(function()
    local leaderstats = LocalPlayer:WaitForChild("leaderstats", 10)
    local winsValue = leaderstats and (leaderstats:FindFirstChild("Wins") or leaderstats:FindFirstChild("Win"))
    if winsValue then
        winsCount = winsValue.Value
        WinsLabel:UpdateEverything("Wins: " .. tostring(winsCount), "Wins get on farm", "Positive")
        winsValue.Changed:Connect(function(val)
            winsCount = val
            WinsLabel:UpdateEverything("Wins: " .. tostring(winsCount), "Wins get on farm", "Positive")
        end)
    end
end)

-- [[ FPS BOOST / BLACK SCREEN ]] --
local blackFrame = Instance.new("Frame")
blackFrame.Size = UDim2.new(1, 0, 1, 0)
blackFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
blackFrame.Visible = false
blackFrame.ZIndex = 9999
blackFrame.Parent = ScreenGui

local function toggleBlackScreen(state)
    blackScreenLigado = state
    blackFrame.Visible = state
    RunService:Set3dRenderingEnabled(not state)
end

-- [[ TOOL SCRIPT LOGIC ]] --
local s = false
local k = {}

local function createTool()
    local t = Instance.new("Tool")
    t.Name = "Jerk Off"
    t.RequiresHandle = false
    t.Parent = LocalPlayer.Backpack
    
    local function e(id, t1, t2, id2)
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if not hum then return end
        local a = Instance.new("Animation")
        a.AnimationId = "rbxassetid://" .. id
        local tr = hum:LoadAnimation(a)
        k[id2] = RunService.RenderStepped:Connect(function()
            if s then
                if tr.TimePosition >= t2 or tr.IsPlaying == false then
                    tr:Play()
                    tr.TimePosition = t1
                end
            else
                tr:Stop()
            end
        end)
        tr:Play()
        tr.TimePosition = t1
    end

    t.Equipped:Connect(function()
        s = true
        e("72042024", 0.5, 0.9, 1)
        e("168268306", 1, 1.001, 2)
    end)

    t.Unequipped:Connect(function()
        s = false
        for i, v in pairs(k) do v:Disconnect() end
        k = {}
    end)
end

-- [[ CLEANUP ]] --
local function cleanMap()
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name == "KillBrick" or obj.Name == "Invis") then
            obj:Destroy()
        end
    end
end

-- [[ FLY LOGIC ]] --
local bodyVelocity, bodyGyro
local function toggleFly()
    flyLigado = not flyLigado
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if flyLigado and root and hum then
        hum.PlatformStand = true
        bodyGyro = Instance.new("BodyGyro", root)
        bodyGyro.P = 9e4
        bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.cframe = root.CFrame
        bodyVelocity = Instance.new("BodyVelocity", root)
        bodyVelocity.velocity = Vector3.new(0, 0.1, 0)
        bodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)

        task.spawn(function()
            while flyLigado do
                local cam = Workspace.CurrentCamera.CFrame
                local direction = Vector3.new(0, 0, 0)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then direction = direction + cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then direction = direction - cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then direction = direction - cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then direction = direction + cam.RightVector end
                bodyVelocity.velocity = direction * flySpeed
                bodyGyro.cframe = cam
                RunService.RenderStepped:Wait()
            end
            if bodyVelocity then bodyVelocity:Destroy() end
            if bodyGyro then bodyGyro:Destroy() end
            if hum then hum.PlatformStand = false end
        end)
    end
end

-- Hotkey F
UserInputService.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.F then toggleFly() end
end)

-- [[ TELEPORT LOOP (FIXED) ]] --
task.spawn(function()
    while true do
        if tpLigado then
            pcall(function()
                local target = nil
                -- Volta para a busca direta no Workspace
                for _, obj in pairs(Workspace:GetDescendants()) do
                    if obj.Name == NOME_DA_PART and obj:IsA("BasePart") then
                        target = obj
                        break
                    end
                end

                if target then
                    local char = LocalPlayer.Character
                    local root = char and char:FindFirstChild("HumanoidRootPart")
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    if root and hum then
                        hum.Jump = true -- Faz o pulo para detectar movimento
                        task.wait(0.05)
                        root.CFrame = target.CFrame * CFrame.new(0, ALTURA_OFFSET, 0)
                        root.Velocity = Vector3.new(0, 0, 0)
                    end
                end
            end)
        end
        task.wait(INTERVALO)
    end
end)

-- [[ UI ELEMENTS ]] --

Tabs.Main:NewToggleEntry("Auto Farm (WinPart)", "Jump & TP every 0.7s", false, function(state)
    tpLigado = state
end)

Tabs.Main:NewToggleEntry("Fly (F to toggle)", "Enable Flight", false, function(state)
    if state ~= flyLigado then toggleFly() end
end)

Tabs.Main:NewToggleEntry("Anti-AFK", "Prevent disconnect", false, function(state)
    afkLigado = state
end)

Tabs.Utilities:NewToggleEntry("Black Screen (FPS Boost)", "Disables 3D for performance", false, function(state)
    toggleBlackScreen(state)
end)

Tabs.Utilities:NewButtonEntry("Give Jerk Off Tool", "Adds tool to backpack", function()
    createTool()
end)

Tabs.Utilities:NewButtonEntry("Destroy KillBricks/Invis", "Removes hazards", function()
    cleanMap()
end)

-- Anti-AFK Logic
LocalPlayer.Idled:Connect(function()
    if afkLigado then
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton2(Vector2.new())
    end
end)

print("Sigma Hub loaded successfully")
