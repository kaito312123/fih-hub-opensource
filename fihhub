-- [[ LIBRARY LOADING ]] --
local HttpRequest = request or http_request or http and http.request or syn and syn.request
local ModuleData = HttpRequest({Method = "GET", Url = "https://raw.githubusercontent.com/KadeTheExploiter/Machina/refs/heads/main/Module.luau"})
local GuiLibrary = loadstring(ModuleData.Body)()

-- [[ CONFIGURATIONS ]] --
local NOME_DA_PART = "WINPART"
local ALTURA_OFFSET = 7
local INTERVALO = 0.7 
local tpLigado = false
local afkLigado = false
local flyLigado = false
local flySpeed = 50

-- [[ SERVICES ]] --
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- [[ SIGMA HUB INTERFACE ]] --
local MainFrame, ScreenGui = GuiLibrary:Load("Sigma Hub", "Dark")

local Tabs = {
    Main = MainFrame:NewTabEntry("Main", "rbxassetid://10734945662"),
    Scripts = MainFrame:NewTabEntry("Utilities", "rbxassetid://10734944532")
}

-- [[ TOOL SCRIPT LOGIC ]] --
local s = false
local k = {}

local function createTool()
    local t = Instance.new("Tool")
    t.Name = "Jerk Off" -- O nome que aparece na mochila
    t.RequiresHandle = false
    t.Parent = LocalPlayer.Backpack
    
    local function e(id, t1, t2, id2)
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if not hum then return end
        local a = Instance.new("Animation")
        a.AnimationId = "rbxassetid://" .. id
        local tr = hum:LoadAnimation(a)
        k[id2] = RunService.RenderStepped:Connect(function()
            if s then
                if tr.TimePosition >= t2 or tr.IsPlaying == false then
                    tr:Play()
                    tr.TimePosition = t1
                end
            else
                tr:Stop()
            end
        end)
        tr:Play()
        tr.TimePosition = t1
    end

    local function x()
        s = true
        e("72042024", 0.5, 0.9, 1)
        e("168268306", 1, 1.001, 2)
    end

    local function stop()
        s = false
        for i, v in pairs(k) do v:Disconnect() end
        k = {}
    end

    t.Equipped:Connect(x)
    t.Unequipped:Connect(stop)
    
    -- Notificação de sucesso
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Tool Received",
        Text = "Jerk Off tool added to backpack!",
        Duration = 2
    })
end

-- [[ CLEANUP FUNCTION ]] --
local function cleanMap()
    local count = 0
    for _, obj in pairs(game.Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name == "KillBrick" or obj.Name == "Invis") then
            obj:Destroy()
            count = count + 1
        end
    end
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Map Cleaned",
        Text = "Removed " .. count .. " dangerous objects.",
        Duration = 3
    })
end

-- [[ FLY LOGIC ]] --
local bodyVelocity, bodyGyro
local function toggleFly()
    flyLigado = not flyLigado
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if flyLigado and root and hum then
        hum.PlatformStand = true
        bodyGyro = Instance.new("BodyGyro", root)
        bodyGyro.P = 9e4
        bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.cframe = root.CFrame

        bodyVelocity = Instance.new("BodyVelocity", root)
        bodyVelocity.velocity = Vector3.new(0, 0.1, 0)
        bodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)

        task.spawn(function()
            while flyLigado do
                local cam = workspace.CurrentCamera.CFrame
                local direction = Vector3.new(0, 0, 0)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then direction = direction + cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then direction = direction - cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then direction = direction - cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then direction = direction + cam.RightVector end
                bodyVelocity.velocity = direction * flySpeed
                bodyGyro.cframe = cam
                RunService.RenderStepped:Wait()
            end
            if bodyVelocity then bodyVelocity:Destroy() end
            if bodyGyro then bodyGyro:Destroy() end
            if hum then hum.PlatformStand = false end
        end)
    end
end

-- Fly Hotkey (F)
UserInputService.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.F then
        toggleFly()
    end
end)

-- [[ TELEPORT LOGIC ]] --
task.spawn(function()
    while true do
        if tpLigado then
            pcall(function()
                local target = nil
                for _, obj in pairs(game.Workspace:GetDescendants()) do
                    if obj.Name == NOME_DA_PART and obj:IsA("BasePart") then
                        target = obj
                        break
                    end
                end
                if target then
                    local char = LocalPlayer.Character
                    local root = char and char:FindFirstChild("HumanoidRootPart")
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    if root and hum then
                        hum.Jump = true
                        task.wait(0.05) 
                        root.CFrame = target.CFrame * CFrame.new(0, ALTURA_OFFSET, 0)
                        root.Velocity = Vector3.new(0, 0, 0)
                    end
                end
            end)
        end
        task.wait(INTERVALO)
    end
end)

-- [[ UI ELEMENTS ]] --

-- Main Tab
Tabs.Main:NewToggleEntry("Auto Farm (WinPart)", "Jump & TP every 0.7s", false, function(state)
    tpLigado = state
end)

Tabs.Main:NewToggleEntry("Fly (F to toggle)", "Fly around the map", false, function(state)
    if state ~= flyLigado then toggleFly() end
end)

Tabs.Main:NewToggleEntry("Anti-AFK", "Prevent disconnect", false, function(state)
    afkLigado = state
end)

-- Utilities Tab
Tabs.Scripts:NewButtonEntry("Give Jerk Off Tool", "Adds the tool to your backpack", function()
    createTool()
end)

Tabs.Scripts:NewButtonEntry("Destroy KillBricks/Invis", "Removes map hazards", function()
    cleanMap()
end)

-- [[ ANTI-AFK LOGIC ]] --
LocalPlayer.Idled:Connect(function()
    if afkLigado then
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton2(Vector2.new())
    end
end)

print("Sigma Hub loaded successfully")
