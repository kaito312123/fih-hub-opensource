-- [[ LIBRARY LOADING ]] --
local HttpRequest = request or http_request or http and http.request or syn and syn.request
local ModuleData = HttpRequest({Method = "GET", Url = "https://raw.githubusercontent.com/KadeTheExploiter/Machina/refs/heads/main/Module.luau"})
local GuiLibrary = loadstring(ModuleData.Body)()

-- [[ CONFIGURATIONS ]] --
local TARGET_PART_NAME = "WINPART"
local HEIGHT_OFFSET = 7
local REFRESH_INTERVAL = 0.7 
local tpEnabled = false
local afkEnabled = false
local flyEnabled = false
local blackScreenEnabled = false
local flySpeed = 50
local winsCount = 0

-- [[ SERVICES ]] --
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- [[ SIGMA HUB INTERFACE ]] --
local MainFrame, ScreenGui = GuiLibrary:Load("Sigma Hub", "Dark")

local Tabs = {
    Main = MainFrame:NewTabEntry("Main", "rbxassetid://10734945662"),
    Utilities = MainFrame:NewTabEntry("Utilities", "rbxassetid://10734944532")
}

-- [[ WINS COUNTER ]] --
local WinsLabel = Tabs.Main:NewLabelEntry(
    "Wins: 0", 
    "Wins get on farm", 
    "Positive"
)

-- Monitor Win changes
task.spawn(function()
    local leaderstats = LocalPlayer:WaitForChild("leaderstats", 5)
    local winsValue = leaderstats and (leaderstats:FindFirstChild("Wins") or leaderstats:FindFirstChild("Win"))
    
    if winsValue then
        winsValue.Changed:Connect(function(val)
            winsCount = val
            WinsLabel:UpdateEverything("Wins: " .. tostring(winsCount), "Wins get on farm", "Positive")
        end)
    end
end)

-- [[ FPS BOOST / BLACK SCREEN LOGIC ]] --
local blackFrame = Instance.new("Frame")
blackFrame.Size = UDim2.new(1, 0, 1, 0)
blackFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
blackFrame.Visible = false
blackFrame.ZIndex = 9999
blackFrame.Parent = ScreenGui

local function toggleBlackScreen(state)
    blackScreenEnabled = state
    blackFrame.Visible = state
    RunService:Set3dRenderingEnabled(not state) -- Real FPS Boost by disabling 3D rendering
end

-- [[ TOOL SCRIPT LOGIC ]] --
local isPlayingAnim = false
local animConnections = {}

local function createTool()
    local tool = Instance.new("Tool")
    tool.Name = "Jerk Off"
    tool.RequiresHandle = false
    tool.Parent = LocalPlayer.Backpack
    
    local function playAnimation(id, startTime, endTime, connectionID)
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if not hum then return end
        
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. id
        local track = hum:LoadAnimation(anim)
        
        animConnections[connectionID] = RunService.RenderStepped:Connect(function()
            if isPlayingAnim then
                if track.TimePosition >= endTime or track.IsPlaying == false then
                    track:Play()
                    track.TimePosition = startTime
                end
            else
                track:Stop()
            end
        end)
        track:Play()
        track.TimePosition = startTime
    end

    tool.Equipped:Connect(function()
        isPlayingAnim = true
        playAnimation("72042024", 0.5, 0.9, 1)
        playAnimation("168268306", 1, 1.001, 2)
    end)

    tool.Unequipped:Connect(function()
        isPlayingAnim = false
        for _, connection in pairs(animConnections) do connection:Disconnect() end
        animConnections = {}
    end)

    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Success",
        Text = "Jerk Off tool added!",
        Duration = 2
    })
end

-- [[ MAP CLEANUP ]] --
local function cleanMap()
    local count = 0
    for _, obj in pairs(game.Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name == "KillBrick" or obj.Name == "Invis") then
            obj:Destroy()
            count = count + 1
        end
    end
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Cleaned",
        Text = "Removed " .. count .. " dangerous objects.",
        Duration = 3
    })
end

-- [[ FLY LOGIC ]] --
local bodyVelocity, bodyGyro
local function toggleFly()
    flyEnabled = not flyEnabled
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if flyEnabled and root and hum then
        hum.PlatformStand = true
        bodyGyro = Instance.new("BodyGyro", root)
        bodyGyro.P = 9e4
        bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.cframe = root.CFrame
        bodyVelocity = Instance.new("BodyVelocity", root)
        bodyVelocity.velocity = Vector3.new(0, 0.1, 0)
        bodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)

        task.spawn(function()
            while flyEnabled do
                local cam = workspace.CurrentCamera.CFrame
                local direction = Vector3.new(0, 0, 0)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then direction = direction + cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then direction = direction - cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then direction = direction - cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then direction = direction + cam.RightVector end
                bodyVelocity.velocity = direction * flySpeed
                bodyGyro.cframe = cam
                RunService.RenderStepped:Wait()
            end
            if bodyVelocity then bodyVelocity:Destroy() end
            if bodyGyro then bodyGyro:Destroy() end
            if hum then hum.PlatformStand = false end
        end)
    end
end

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.F then toggleFly() end
end)

-- [[ TELEPORT LOOP ]] --
task.spawn(function()
    while true do
        if tpEnabled then
            pcall(function()
                local target = nil
                for _, obj in pairs(game.Workspace:GetDescendants()) do
                    if obj.Name == TARGET_PART_NAME and obj:IsA("BasePart") then
                        target = obj
                        break
                    end
                end
                if target then
                    local char = LocalPlayer.Character
                    local root = char and char:FindFirstChild("HumanoidRootPart")
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    if root and hum then
                        hum.Jump = true
                        task.wait(0.05) 
                        root.CFrame = target.CFrame * CFrame.new(0, HEIGHT_OFFSET, 0)
                        root.Velocity = Vector3.new(0, 0, 0)
                    end
                end
            end)
        end
        task.wait(REFRESH_INTERVAL)
    end
end)

-- [[ UI ELEMENTS ]] --

-- Main Tab
Tabs.Main:NewToggleEntry("Auto Farm (WinPart)", "Jump & TP every 0.7s", false, function(state)
    tpEnabled = state
end)

Tabs.Main:NewToggleEntry("Fly (F to toggle)", "Enable Flight", false, function(state)
    if state ~= flyEnabled then toggleFly() end
end)

Tabs.Main:NewToggleEntry("Anti-AFK", "Prevent disconnect", false, function(state)
    afkEnabled = state
end)

-- Utilities Tab
Tabs.Utilities:NewToggleEntry("Black Screen (FPS Boost)", "Disables 3D for performance", false, function(state)
    toggleBlackScreen(state)
end)

Tabs.Utilities:NewButtonEntry("Give Jerk Off Tool", "Adds tool to backpack", function()
    createTool()
end)

Tabs.Utilities:NewButtonEntry("Destroy KillBricks/Invis", "Removes hazards", function()
    cleanMap()
end)

-- Anti-AFK Logic
LocalPlayer.Idled:Connect(function()
    if afkEnabled then
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton2(Vector2.new())
    end
end)

print("Sigma Hub loaded successfully")
